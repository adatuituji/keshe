#include "config.h"
#include "lib_io.h"
#include "lib_arm.h"
/*
输入端口1安装近红外传感器，装配在擂台小车左侧，检测到悬崖边时右转
输入端口3安装近红外传感器，装配在擂台小车右侧，检测到悬崖边时左转
输入端口2安装近红外传感器，装配在擂台小车后方，检测到悬崖边时前进
输出端口1安装左侧前轮舵机
输出端口2安装右侧前轮舵机
输出端口3安装左侧后轮舵机
输出端口4安装右侧后轮舵机
*/
int main(void)
{
int i,j;
unsigned int flag=1; //擂台小车状态，1为离开悬崖状态，0为前进寻找黑点状态
int a=10;
int b;
Initial_ARM(); //初始化硬件
DelayNS(1500); //延时，确保初始化完成
while(1)
{
if(Input(1,1)==0) //输入端口1的左侧近红外传感器检测到悬崖
{
LedIn(1,2); //输入端口1的LED亮灯，其他输入端口LED灭灯
LedIn(2,0);
LedIn(3,0);
LedIn(4,0);
LedOut(1,1); //输出端口1的LED亮灯，输出端口2的LED灭灯
LedOut(2,0);
Servo(1,120); //输出端口1左侧前轮正转
Servo(3,120); //输出端口3左侧后轮正转
Servo(2,60); //输出端口2右侧前轮反转
Servo(4,60); //输出端口4右侧后轮反转
DelayNS(1500); //延时
flag=1;
}
else if(Input(2,1)==0) //输入端口2的右侧近红外传感器检测到悬崖
{
LedIn(1,0);
LedIn(2,2); //输入端口2的LED亮灯，其他输入端口LED灭灯
LedIn(3,0);
LedIn(4,0);
LedOut(1,0);
LedOut(2,1);
Servo(1,60); //输出端口1左侧轮子反转
Servo(3,60); //输出端口3左侧轮子反转
Servo(2,120); //输出端口2右侧轮子正转
Servo(4,120); //输出端口4右侧轮子正转
DelayNS(1500); //延时
flag=1;
}
else if(Input(3,1)==0) //输入端口3的后部近红外传感器检测到悬崖
{
LedIn(1,0);
LedIn(2,0);
LedIn(3,2);
LedIn(4,0);
LedOut(1,1);
LedOut(2,1);
Servo(1,60); //四轮舵机同向同速转动，使擂台小车前进
Servo(3,60);
Servo(2,120);
Servo(4,120);
DelayNS(500); //前进时间
Servo(1,175); //两侧轮反向转动，使擂台小车原地转向
Servo(3,175);
Servo(2,175);
Servo(4,175);
DelayNS(100000); //转动一定角度
flag=1;
}
else if(Input(4,1)==0) //输入端口4的黑标传感器检测到黑标
{
Servo(1,90);
Servo(2,90);
Servo(3,90);
Servo(4,90);
DelayNS(1000);
flag=1;
}
if(flag==1) //擂台小车寻找黑点模式
{
flag=0;
LedIn(1,0);
LedIn(2,0);
LedIn(3,0);
LedIn(4,2);
LedOut(1,1);
LedOut(2,1);
Servo(1,60); //双轮同向转动，使擂台小车前进
Servo(3,60);
Servo(2,120);
Servo(4,120);
}
}
return(1);
}
