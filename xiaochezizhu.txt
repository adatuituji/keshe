#include "config.h"
#include "lib_io.h"
#include "lib_arm.h"
/*
硬件安装说明：
输入端口1安装触须传感器，装配在扫地机器人左侧，检测到障碍时右转
输入端口3安装触须传感器，装配在扫地机器人右侧，检测到障碍时左转
输入端口2安装近红外传感器，装配在扫地机器人中间，检测到障碍时后退
输出端口1安装左侧轮子舵机
输出端口2安装右侧轮子舵机
输出端口3安装中间扫把轮子舵机
*/
int main(void) {
int i,j;
unsigned int flag=1; //扫地机器人状态，1为障碍躲避状态，0为正常前进状态
int a=10;
int b;
Initial_ARM(); //初始化硬件
DelayNS(1500); //延时，确保初始化完成
while(1) {
if(Input(1,1)==1) //输入端口1的左侧触须传感器检测到障碍
{
LedIn(1,2); //输入端口1的LED亮灯，其他输入端口LED灭灯
LedIn(2,0);
LedIn(3,0);
LedIn(4,0);
LedOut(1,1); //输出端口1的LED亮灯，输出端口2的LED灭灯
LedOut(2,0);
Servo(1,120); //输出端口1左侧轮子转动
Servo(2,90); //输出端口2右侧轮子静止，实现扫地机器人右转
DelayNS(1500); //延时一段时间，保证扫地机器人转动约90度
flag=1; //置扫地机器人为避障状态
}
else if(Input(2,1)==1) //输入端口2的右侧触须传感器检测到障碍
{
LedIn(1,0);
LedIn(2,2); //输入端口2的LED亮灯，其他输入端口LED灭灯
LedIn(3,0);
LedIn(4,0);
LedOut(1,0);
LedOut(2,1);
Servo(1,90); //输出端口1左侧轮子静止，实现扫地机器人右转
Servo(2,60); //输出端口2右侧轮子转动
DelayNS(1500);
flag=1; }
else if(Input(3,1)==1) //输入端口3的中间近红外传感器检测到障碍
{
LedIn(1,0);
LedIn(2,0);
LedIn(3,2);
LedIn(4,0);
LedOut(1,1);
LedOut(2,1);
Servo(1,120); //双轮舵机同向同速转动，使扫地机器人后退
Servo(2,60);
DelayNS(1000); //后退一定时间（即距离）
Servo(1,175); //双轮反向转动，使扫地机器人原地转向
Servo(2,175);
DelayNS(2100); //转动一定角度
flag=1; }
if(flag==1) //使扫地机器人在正常状态下，自主前进并扫地
{
flag=0;
LedIn(1,0);
LedIn(2,0);
LedIn(3,0);
LedIn(4,2);
LedOut(1,1);
LedOut(2,1);
Servo(1,60); //双轮同向转动，使扫地机器人前进
Servo(2,120);
Servo(3,120); //控制扫地舵机持续转动，清扫地面杂物
} }
return(1);
}
